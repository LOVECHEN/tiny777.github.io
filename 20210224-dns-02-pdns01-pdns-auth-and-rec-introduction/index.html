

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://resource.tinychen.com/logos.png">
  <link rel="icon" href="https://resource.tinychen.com/logos.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="TinyChen">
  <meta name="keywords" content="">
  
    <meta name="description" content="本文主要介绍PowerDNS的主要特性和初始化安装的配置方法，侧重点是对复杂程度相对较高PowerDNS Authoritative Server进行介绍，同时会夹杂部分PowerDNS-Recursor的初始化安装和配置。">
<meta property="og:type" content="article">
<meta property="og:title" content="PowerDNS篇1-简介和安装">
<meta property="og:url" content="https://tinychen.com/20210224-dns-02-pdns01-pdns-auth-and-rec-introduction/index.html">
<meta property="og:site_name" content="TinyChen&#39;s Studio">
<meta property="og:description" content="本文主要介绍PowerDNS的主要特性和初始化安装的配置方法，侧重点是对复杂程度相对较高PowerDNS Authoritative Server进行介绍，同时会夹杂部分PowerDNS-Recursor的初始化安装和配置。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://resource.tinychen.com/20210111105305s.jpg">
<meta property="article:published_time" content="2021-02-24T03:00:00.000Z">
<meta property="article:modified_time" content="2021-02-24T03:00:00.000Z">
<meta property="article:author" content="TinyChen">
<meta property="article:tag" content="dns">
<meta property="article:tag" content="powerdns">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://resource.tinychen.com/20210111105305s.jpg">
  
  
  <title>PowerDNS篇1-简介和安装 - TinyChen&#39;s Studio</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tinychen.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":30,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"bash"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"7a96963a1145ac7fde1442d739a11ffd","google":"UA-166769908-1","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="TinyChen's Studio" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>TinyChen</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://resource.tinychen.com/20210111105305.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="PowerDNS篇1-简介和安装"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-02-24 11:00" pubdate>
          February 24, 2021 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          12k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          103 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">PowerDNS篇1-简介和安装</h1>
            
              <p class="note note-info">
                
                  
                    Last updated on February 24, 2021 am
                  
                
              </p>
            
            <div class="markdown-body">
              
              <p>本文主要介绍PowerDNS的主要特性和初始化安装的配置方法，侧重点是对复杂程度相对较高<code>PowerDNS Authoritative Server</code>进行介绍，同时会夹杂部分<code>PowerDNS-Recursor</code>的初始化安装和配置。</p>
<span id="more"></span>

<h1 id="1、PowerDNS简介"><a href="#1、PowerDNS简介" class="headerlink" title="1、PowerDNS简介"></a>1、PowerDNS简介</h1><p>PowerDNS（PDNS）成立于20世纪90年代末，是开源DNS软件、服务和支持的主要供应商，它们提供的<strong>权威认证DNS服务器</strong>和<strong>递归认证DNS服务器</strong>都是100%开源的软件，同时也和红帽等开源方案提供商一样提供了付费的技术支持版本。同时官方表示为了避免和软件使用者出现竞争，他们只提供服务支持而不提供DNS托管服务。</p>
<blockquote>
<p>Our <a target="_blank" rel="noopener" href="https://www.powerdns.com/auth.html">Authoritative Server</a>, <a target="_blank" rel="noopener" href="https://www.powerdns.com/recursor.html">Recursor</a> and <a target="_blank" rel="noopener" href="http://www.dnsdist.org/">dnsdist</a> products are <strong><a target="_blank" rel="noopener" href="https://www.powerdns.com/opensource.html">100% open source</a></strong>. For the service provider market, OX also sells the <a target="_blank" rel="noopener" href="https://www.open-xchange.com/portfolio/ox-powerdns/">PowerDNS Platform</a> which builds on our Open Source products to deliver an integrated DNS solution with 24/7 support and includes features as parental control, malware filtering, automated attack mitigation, and long-term query logging &amp; searching.</p>
</blockquote>
<p>熟悉DNS工作原理的同学可以大致地将DNS记录的查询分为两种：<strong>查询本地缓存</strong>和<strong>向上递归查询</strong>。和其他的如BIND、dnsmasq等将这些功能集成到一起的DNS软件不同，PowerDNS将其一分为二，分为了<code>PowerDNS Authoritative Server</code>和<code>PowerDNS Recursor</code>，分别对应这两种主要的需求，而我们常说的<code>pdns</code>指的就是<code>PowerDNS Authoritative Server (后面简称PDNS Auth)</code>，主要用途就是作为<strong>权威域名服务器</strong>，当然也可以作为普通的DNS服务器提供DNS查询功能。</p>
<p><img src="https://resource.tinychen.com/20200417112013.png" srcset="/img/loading.gif" lazyload></p>
<p>对于PowerDNS-Recursor，PowerDNS官网介绍其是一个<strong>内置脚本能力</strong>的高性能的<strong>DNS递归查询</strong>服务器，并且已经为一亿五千万个互联网连接提供支持。</p>
<blockquote>
<p>The PowerDNS Recursor is a high-performance DNS recursor with built-in scripting capabilities. It is known to power the resolving needs of over 150 million internet connections.</p>
</blockquote>
<p>PowerDNS-Recursor(以下简称pdns-rec)的官方文档可以点击<a target="_blank" rel="noopener" href="https://doc.powerdns.com/recursor/index.html">这里</a>查看。官方指的内置脚本能力是指在4.0.0版本之后的配置文件里面添加了对lua脚本的支持。</p>
<h1 id="2、PowerDNS安装"><a href="#2、PowerDNS安装" class="headerlink" title="2、PowerDNS安装"></a>2、PowerDNS安装</h1><h2 id="2-1-PowerDNS-Authoritative-Server安装"><a href="#2-1-PowerDNS-Authoritative-Server安装" class="headerlink" title="2.1 PowerDNS Authoritative Server安装"></a>2.1 PowerDNS Authoritative Server安装</h2><p>这里我们还是使用经典的CentOS7系统进行安装测试，系统的相关版本和内核信息如下：</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ lsb_release -a
LSB Version:    :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch
Distributor ID: CentOS
Description:    CentOS Linux release <span class="token number">7.9</span>.2009 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
Release:        <span class="token number">7.9</span>.2009
Codename:       Core
$ <span class="token function">uname</span> -r
<span class="token number">3.10</span>.0-1160.11.1.el7.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p>pdns对主流的操作系统都有着较好的支持，在centos上面可以直接通过repo仓库来安装，红帽系的Linux可以通过epel源，monshouwer提供的第三方源和powerdns官方源三种源来进行安装。</p>
<blockquote>
<p>On RedHat based systems there are 3 options to install PowerDNS, from <a target="_blank" rel="noopener" href="https://fedoraproject.org/wiki/EPEL">EPEL</a>, the <a target="_blank" rel="noopener" href="https://www.monshouwer.eu/download/3rd_party/pdns/">repository from Kees Monshouwer</a> or from <a target="_blank" rel="noopener" href="https://repo.powerdns.com/">the PowerDNS repositories</a>:</p>
</blockquote>
<p>使用epel源来进行安装的话可能会导致无法安装最新版本</p>
<p><img src="https://resource.tinychen.com/20210118145131.png" srcset="/img/loading.gif" lazyload></p>
<p>如果网络条件允许的话，最好的办法是直接通过官方的<a target="_blank" rel="noopener" href="https://repo.powerdns.com/">repo源</a>来进行安装，如果使用的是master源，则可以安装到最新的测试版本：</p>
<div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">yum install epel-release yum-plugin-priorities
curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;powerdns-auth-master.repo https:&#x2F;&#x2F;repo.powerdns.com&#x2F;repo-files&#x2F;centos-auth-master.repo
yum install pdns
yum install pdns-backend-$backend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><img src="https://resource.tinychen.com/20210118145142.png" srcset="/img/loading.gif" lazyload></p>
<p>这里我们使用最新的稳定版4.4版本进行安装，<code>backend</code>这里我们选择<code>pdns-backend-mysql</code></p>
<div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">yum install epel-release yum-plugin-priorities
curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;powerdns-auth-44.repo https:&#x2F;&#x2F;repo.powerdns.com&#x2F;repo-files&#x2F;centos-auth-44.repo
yum install pdns
yum install pdns-backend-$backend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><img src="https://resource.tinychen.com/20210118145147.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>请注意对于某些软件包源，bind backend作为基本pdns软件包的一部分提供，并且没有单独的pdns-backend-bind软件包。</p>
</blockquote>
<h2 id="2-2-PowerDNS-Recursor安装"><a href="#2-2-PowerDNS-Recursor安装" class="headerlink" title="2.2 PowerDNS-Recursor安装"></a>2.2 PowerDNS-Recursor安装</h2><p>这里我们还是使用经典的CentOS7系统进行安装测试，系统的相关版本和内核信息如下：</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@tiny-cloud /home<span class="token punctuation">]</span><span class="token comment"># lsb_release -a</span>
LSB Version:    :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch
Distributor ID: CentOS
Description:    CentOS Linux release <span class="token number">7.9</span>.2009 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
Release:        <span class="token number">7.9</span>.2009
Codename:       Core
<span class="token punctuation">[</span>root@tiny-cloud /home<span class="token punctuation">]</span><span class="token comment"># uname -r</span>
<span class="token number">3.10</span>.0-1160.24.1.el7.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p>pdns对主流的操作系统都有着较好的支持，在红帽系和CentOS系相关的发行版本上面可以之间通过epel源来进行安装，不过使用epel源来进行安装的话可能会导致无法安装最新版本。</p>
<blockquote>
<p>On Red Hat, CentOS and related distributions, ensure that <a target="_blank" rel="noopener" href="https://fedoraproject.org/wiki/EPEL">EPEL</a> is available. To install the PowerDNS Recursor, run <code>yum install pdns-recursor</code> as root.</p>
</blockquote>
<p><img src="https://resource.tinychen.com/20210430141702.png" srcset="/img/loading.gif" lazyload></p>
<p>如果网络条件允许的话，最好的办法是直接通过官方的<a target="_blank" rel="noopener" href="https://repo.powerdns.com/">repo源</a>来进行安装，如果使用的是master分支的repo源，则可以安装到最新的测试版本。官方表示master存储库对应的是他们在<a target="_blank" rel="noopener" href="https://github.com/PowerDNS/pdns">github</a>上面正在开发的master分支。</p>
<div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">yum install epel-release yum-plugin-priorities &amp;&amp;
curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;powerdns-rec-master.repo https:&#x2F;&#x2F;repo.powerdns.com&#x2F;repo-files&#x2F;centos-rec-master.repo &amp;&amp;
yum install pdns-recursor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div>

<p><img src="https://resource.tinychen.com/20210430143317.png" srcset="/img/loading.gif" lazyload></p>
<p>当然我们也可以通过官方提供的不同版本yum源来安装对应版本的pdns，不同的版本分支对应的支持时间也是不一样的，官方表示在对应版本的生命周期结束之后，对应的仓库也不会再提供支持，pdns-rec的EOL信息可以点击<a target="_blank" rel="noopener" href="https://doc.powerdns.com/recursor/appendices/EOL.html">这里</a>查看。由于目前4.5.x版本还处于rc阶段，因此这里我们还是安装最新的稳定版本4.4.x版本。</p>
<div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">yum install epel-release yum-plugin-priorities &amp;&amp;
curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;powerdns-rec-44.repo https:&#x2F;&#x2F;repo.powerdns.com&#x2F;repo-files&#x2F;centos-rec-44.repo &amp;&amp;
yum install pdns-recursor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div>

<p><img src="https://resource.tinychen.com/20210430143305.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="3、pdns-auth的mysql安装配置"><a href="#3、pdns-auth的mysql安装配置" class="headerlink" title="3、pdns-auth的mysql安装配置"></a>3、pdns-auth的mysql安装配置</h1><h2 id="3-1-安装mysql"><a href="#3-1-安装mysql" class="headerlink" title="3.1 安装mysql"></a>3.1 安装mysql</h2><p>pdns对于mysql的版本和安装方式并没有什么特殊的要求，个人推荐版本在5.7+或者8.0+都可以，这里使用yum安装8.0版本的mysql。</p>
<p>最新版的mysql的repo文件我们可以直接前往官网下载：<code>https://dev.mysql.com/downloads/repo/yum/</code></p>
<blockquote>
<p>如果需要使用5.7的版本可以到这里下载</p>
<div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">wget http:&#x2F;&#x2F;repo.mysql.com&#x2F;mysql57-community-release-el7-9.noarch.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div>
</blockquote>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">rpm</span> -ivh mysql80-community-release-el7-3.noarch.rpm
$ yum update
$ yum <span class="token function">install</span> mysql-server
$ mysqladmin --version
mysqladmin  Ver <span class="token number">8.0</span>.23 <span class="token keyword">for</span> Linux on x86_64 <span class="token punctuation">(</span>MySQL Community Server - GPL<span class="token punctuation">)</span>

<span class="token comment"># MYSQL8的初始密码可以在log中查看</span>
$ <span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log
$ mysql -u root -p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h2 id="3-2-创建用户"><a href="#3-2-创建用户" class="headerlink" title="3.2 创建用户"></a>3.2 创建用户</h2><p>接下来需要进行基本的数据库操作，给pdns创建对应的数据库和用户并简单设置相关权限：</p>
<div class="code-wrapper"><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">-- 修改密码
ALTER user &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;你的新密码&#39;;
-- 注意这里的&#39;localhost&#39;也有可能是别的参数，具体可以通过下面这条命令来进行查询：
select user, host, authentication_string, plugin from mysql.user;

-- 创建一个mysql的用户名为powerdns，只能本机登录
-- 创建一个mysql的数据库名为powerdns，并允许powerdns用户访问
CREATE USER &#39;powerdns&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;你的新密码&#39;;
CREATE DATABASE powerdns;
GRANT ALL ON powerdns.* TO &#39;powerdns&#39;@&#39;localhost&#39;;
FLUSH PRIVILEGES;

-- 对于MYSQL8需要额外指定加密方式避免ERROR 2059 (HY000)的问题
ALTER USER &#39;powerdns&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;你的新密码&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h2 id="3-3-创建数据表"><a href="#3-3-创建数据表" class="headerlink" title="3.3 创建数据表"></a>3.3 创建数据表</h2><p>创建数据表的操作完全按照<a target="_blank" rel="noopener" href="https://doc.powerdns.com/authoritative/backends/generic-mysql.html#default-schema">官方的文档</a>进行，有特殊需要的也可以根据实际情况进行修改：</p>
<div class="code-wrapper"><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE domains (
  id                    INT AUTO_INCREMENT,
  name                  VARCHAR(255) NOT NULL,
  master                VARCHAR(128) DEFAULT NULL,
  last_check            INT DEFAULT NULL,
  type                  VARCHAR(6) NOT NULL,
  notified_serial       INT UNSIGNED DEFAULT NULL,
  account               VARCHAR(40) CHARACTER SET &#39;utf8&#39; DEFAULT NULL,
  PRIMARY KEY (id)
) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;

CREATE UNIQUE INDEX name_index ON domains(name);


CREATE TABLE records (
  id                    BIGINT AUTO_INCREMENT,
  domain_id             INT DEFAULT NULL,
  name                  VARCHAR(255) DEFAULT NULL,
  type                  VARCHAR(10) DEFAULT NULL,
  content               VARCHAR(64000) DEFAULT NULL,
  ttl                   INT DEFAULT NULL,
  prio                  INT DEFAULT NULL,
  disabled              TINYINT(1) DEFAULT 0,
  ordername             VARCHAR(255) BINARY DEFAULT NULL,
  auth                  TINYINT(1) DEFAULT 1,
  PRIMARY KEY (id)
) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;

CREATE INDEX nametype_index ON records(name,type);
CREATE INDEX domain_id ON records(domain_id);
CREATE INDEX ordername ON records (ordername);


CREATE TABLE supermasters (
  ip                    VARCHAR(64) NOT NULL,
  nameserver            VARCHAR(255) NOT NULL,
  account               VARCHAR(40) CHARACTER SET &#39;utf8&#39; NOT NULL,
  PRIMARY KEY (ip, nameserver)
) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;


CREATE TABLE comments (
  id                    INT AUTO_INCREMENT,
  domain_id             INT NOT NULL,
  name                  VARCHAR(255) NOT NULL,
  type                  VARCHAR(10) NOT NULL,
  modified_at           INT NOT NULL,
  account               VARCHAR(40) CHARACTER SET &#39;utf8&#39; DEFAULT NULL,
  comment               TEXT CHARACTER SET &#39;utf8&#39; NOT NULL,
  PRIMARY KEY (id)
) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;

CREATE INDEX comments_name_type_idx ON comments (name, type);
CREATE INDEX comments_order_idx ON comments (domain_id, modified_at);


CREATE TABLE domainmetadata (
  id                    INT AUTO_INCREMENT,
  domain_id             INT NOT NULL,
  kind                  VARCHAR(32),
  content               TEXT,
  PRIMARY KEY (id)
) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;

CREATE INDEX domainmetadata_idx ON domainmetadata (domain_id, kind);


CREATE TABLE cryptokeys (
  id                    INT AUTO_INCREMENT,
  domain_id             INT NOT NULL,
  flags                 INT NOT NULL,
  active                BOOL,
  published             BOOL DEFAULT 1,
  content               TEXT,
  PRIMARY KEY(id)
) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;

CREATE INDEX domainidindex ON cryptokeys(domain_id);


CREATE TABLE tsigkeys (
  id                    INT AUTO_INCREMENT,
  name                  VARCHAR(255),
  algorithm             VARCHAR(50),
  secret                VARCHAR(255),
  PRIMARY KEY (id)
) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;

CREATE UNIQUE INDEX namealgoindex ON tsigkeys(name, algorithm);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h1 id="4、pdns配置mysql"><a href="#4、pdns配置mysql" class="headerlink" title="4、pdns配置mysql"></a>4、pdns配置mysql</h1><h2 id="4-1-mysql-相关配置"><a href="#4-1-mysql-相关配置" class="headerlink" title="4.1 mysql 相关配置"></a>4.1 mysql 相关配置</h2><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># gmysql-host</span>
<span class="token comment"># 需要连接的mysql的IP地址，和gmysql-socket变量互斥</span>

<span class="token comment"># gmysql-port</span>
<span class="token comment"># 需要连接的mysql的端口号，默认是3306</span>

<span class="token comment"># gmysql-socket</span>
<span class="token comment"># 需要连接的mysql的UNIX socket地址，和gmysql-host互斥</span>

<span class="token comment"># gmysql-dbname</span>
<span class="token comment"># 需要连接的数据库，默认：powerdns</span>

<span class="token comment"># gmysql-user</span>
<span class="token comment"># 连接数据库的用户名，默认：powerdns</span>

<span class="token comment"># gmysql-group</span>
<span class="token comment"># 连接数据库的组，默认：client</span>

<span class="token comment"># gmysql-password</span>
<span class="token comment"># 连接数据库的用户的密码</span>

<span class="token comment"># gmysql-dnssec</span>
<span class="token comment"># 是否启用dnssec功能，默认：no</span>

<span class="token comment"># gmysql-innodb-read-committed</span>
<span class="token comment"># 使用InnoDB的READ-COMMITTED事务隔离，默认：yes</span>

<span class="token comment"># gmysql-ssl</span>
<span class="token comment"># 是否开启SSL支持，默认：no</span>

<span class="token comment"># gmysql-timeout</span>
<span class="token comment"># 尝试读取数据库的超时时间，0为禁用，默认：10</span>

<span class="token comment"># gmysql-thread-cleanup</span>
<span class="token comment"># 对于一些老旧版本的MySQL/MariaDB（比如RHEL7内置的版本）会出现内存泄露的问题，除非应用程序明确向该库报告每个线程的结束。启用gmysql-thread-cleanup告诉PowerDNS每当线程结束时就调用mysql_thread_end（）。</span>
<span class="token comment"># 只有当确定自己需要开启这个功能的时候再开启，详情可以查看https://github.com/PowerDNS/pdns/issues/6231.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h2 id="4-2-pdns-conf配置"><a href="#4-2-pdns-conf配置" class="headerlink" title="4.2 pdns.conf配置"></a>4.2 pdns.conf配置</h2><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /etc/pdns/pdns.conf
<span class="token assign-left variable">api</span><span class="token operator">=</span>yes
api-key<span class="token operator">=</span>你的API-KEY
config-dir<span class="token operator">=</span>/etc/pdns
write-pid<span class="token operator">=</span>yes

<span class="token assign-left variable">daemon</span><span class="token operator">=</span>no
<span class="token assign-left variable">guardian</span><span class="token operator">=</span>no

<span class="token assign-left variable">launch</span><span class="token operator">=</span>gmysql
gmysql-host<span class="token operator">=</span>localhost
gmysql-port<span class="token operator">=</span><span class="token number">3306</span>
gmysql-dbname<span class="token operator">=</span>你的数据库名
gmysql-user<span class="token operator">=</span>你的用户名
gmysql-password<span class="token operator">=</span>你的密码

log-dns-details<span class="token operator">=</span>yes
log-dns-queries<span class="token operator">=</span>yes
log-timestamp<span class="token operator">=</span>yes
<span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">9</span>
logging-facility<span class="token operator">=</span><span class="token number">0</span>
log-timestamp<span class="token operator">=</span>yes

<span class="token assign-left variable">setgid</span><span class="token operator">=</span>root
<span class="token assign-left variable">setuid</span><span class="token operator">=</span>root

<span class="token assign-left variable">webserver</span><span class="token operator">=</span>yes
webserver-address<span class="token operator">=</span><span class="token number">192.168</span>.100.100
webserver-loglevel<span class="token operator">=</span>detailed
webserver-port<span class="token operator">=</span><span class="token number">8081</span>
<span class="token comment"># webserver-allow-from指定允许访问webserver和API的IP白名单，多个IP可以使用英文逗号隔开</span>
webserver-allow-from<span class="token operator">=</span><span class="token number">192.168</span>.100.0/24
<span class="token comment"># pdns服务监听的地址，多个IP可以使用英文逗号隔开</span>
local-address<span class="token operator">=</span><span class="token number">192.168</span>.100.100
query-local-address<span class="token operator">=</span><span class="token number">192.168</span>.100.100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h2 id="4-3-pdns-rec配置"><a href="#4-3-pdns-rec配置" class="headerlink" title="4.3 pdns-rec配置"></a>4.3 pdns-rec配置</h2><p>pdns-rec的配置文件除了默认文件命名和少数特殊的配置项外，其他的绝大部分配置都和pdns-auth一致，这里不作赘述。</p>
<div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">[root@tiny-cloud &#x2F;etc&#x2F;pdns-recursor]# realpath recursor.conf
&#x2F;etc&#x2F;pdns-recursor&#x2F;recursor.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div>



<h1 id="5、pdns日志处理"><a href="#5、pdns日志处理" class="headerlink" title="5、pdns日志处理"></a>5、pdns日志处理</h1><p>官网的相关文档可以点击<a target="_blank" rel="noopener" href="https://doc.powerdns.com/authoritative/running.html#logging-to-syslog">这里</a>查看，debug阶段我们把日志级别调到了最高的9，为了避免错过重要信息，我们把日志按照不同的级别分别写入不同的文件中。</p>
<p>修改centos对应的rsyslog配置文件并且重启服务</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># mkdir -p /etc/pdns/logs</span>

<span class="token comment"># cat /etc/rsyslog.conf | grep pdns</span>
local0.info                       /etc/pdns/logs/pdns.info.log
local0.warn                       /etc/pdns/logs/pdns.warn.log
local0.err                        /etc/pdns/logs/pdns.err.log

systemctl restart rsyslog.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p>修改pdns的<code>systemd</code>的<code>unit</code>文件，将里面的禁用<code>syslog</code>参数去掉，同时将其他多余的控制选项也一并去除，统一将各类参数设置集中到<code>pdns.conf</code>文件中，方便后期的管理和运维。</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /usr/lib/systemd/system/pdns.service

<span class="token comment"># 将原来的启动参数全部替换掉</span>
<span class="token comment"># ExecStart=/usr/sbin/pdns_server --socket-dir=%t/pdns --guardian=no --daemon=no --disable-syslog --log-timestamp=no --write-pid=no</span>
<span class="token comment"># 替换为</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/pdns_server --socket-dir<span class="token operator">=</span>%t/pdns

systemctl daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h1 id="6、pdns-auth的API请求"><a href="#6、pdns-auth的API请求" class="headerlink" title="6、pdns-auth的API请求"></a>6、pdns-auth的API请求</h1><p>PDNS提供了API功能，请求的时候需要注意正确携带配置中的<code>api-key</code>，否则会无法返回正确的结果，而是显示<code>401 Unauthorized</code>错误。</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">curl</span> -v http://192.168.100.100:8081/api/v1/servers
*   Trying <span class="token number">192.168</span>.100.100<span class="token punctuation">..</span>.
* TCP_NODELAY <span class="token builtin class-name">set</span>
* Connected to <span class="token number">192.168</span>.100.100 <span class="token punctuation">(</span><span class="token number">192.168</span>.100.100<span class="token punctuation">)</span> port <span class="token number">8081</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
<span class="token operator">></span> GET /api/v1/servers HTTP/1.1
<span class="token operator">></span> Host: <span class="token number">192.168</span>.100.100:8081
<span class="token operator">></span> User-Agent: curl/7.61.1
<span class="token operator">></span> Accept: */*
<span class="token operator">></span>
<span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">401</span> Unauthorized
<span class="token operator">&lt;</span> Connection: close
<span class="token operator">&lt;</span> Content-Length: <span class="token number">12</span>
<span class="token operator">&lt;</span> Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
<span class="token operator">&lt;</span> Server: PowerDNS/4.4.0
<span class="token operator">&lt;</span> Www-Authenticate: X-API-Key <span class="token assign-left variable">realm</span><span class="token operator">=</span><span class="token string">"PowerDNS"</span>
<span class="token operator">&lt;</span>
* Closing connection <span class="token number">0</span>
Unauthorized<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p>请求正确的情况下会返回<code>json</code>格式的信息。</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">curl</span> -v -H <span class="token string">'X-API-Key: 配置中的api-key'</span> http://192.168.100.100:8081/api/v1/servers
*   Trying <span class="token number">192.168</span>.100.100<span class="token punctuation">..</span>.
* TCP_NODELAY <span class="token builtin class-name">set</span>
* Connected to <span class="token number">192.168</span>.100.100 <span class="token punctuation">(</span><span class="token number">192.168</span>.100.100<span class="token punctuation">)</span> port <span class="token number">8081</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
<span class="token operator">></span> GET /api/v1/servers HTTP/1.1
<span class="token operator">></span> Host: <span class="token number">192.168</span>.100.100:8081
<span class="token operator">></span> User-Agent: curl/7.61.1
<span class="token operator">></span> Accept: */*
<span class="token operator">></span> X-API-Key: 配置中的api-key
<span class="token operator">></span>
<span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">200</span> OK
<span class="token operator">&lt;</span> Access-Control-Allow-Origin: *
<span class="token operator">&lt;</span> Connection: close
<span class="token operator">&lt;</span> Content-Length: <span class="token number">249</span>
<span class="token operator">&lt;</span> Content-Security-Policy: default-src <span class="token string">'self'</span><span class="token punctuation">;</span> style-src <span class="token string">'self'</span> <span class="token string">'unsafe-inline'</span>
<span class="token operator">&lt;</span> Content-Type: application/json
<span class="token operator">&lt;</span> Server: PowerDNS/4.4.0
<span class="token operator">&lt;</span> X-Content-Type-Options: nosniff
<span class="token operator">&lt;</span> X-Frame-Options: deny
<span class="token operator">&lt;</span> X-Permitted-Cross-Domain-Policies: none
<span class="token operator">&lt;</span> X-Xss-Protection: <span class="token number">1</span><span class="token punctuation">;</span> <span class="token assign-left variable">mode</span><span class="token operator">=</span>block
<span class="token operator">&lt;</span>
* Closing connection <span class="token number">0</span>
<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"config_url"</span><span class="token builtin class-name">:</span> <span class="token string">"/api/v1/servers/localhost/config&#123;/config_setting&#125;"</span>, <span class="token string">"daemon_type"</span><span class="token builtin class-name">:</span> <span class="token string">"authoritative"</span>, <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token string">"localhost"</span>, <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"Server"</span>, <span class="token string">"url"</span><span class="token builtin class-name">:</span> <span class="token string">"/api/v1/servers/localhost"</span>, <span class="token string">"version"</span><span class="token builtin class-name">:</span> <span class="token string">"4.4.0"</span>, <span class="token string">"zones_url"</span><span class="token builtin class-name">:</span> <span class="token string">"/api/v1/servers/localhost/zones&#123;/zone&#125;"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h1 id="7、DNS解析"><a href="#7、DNS解析" class="headerlink" title="7、DNS解析"></a>7、DNS解析</h1><p>对于pdns-rec而言，是单纯的一个递归查询器（Recursor），会根据设置的缓存时间来缓存向上查询到的DNS记录。</p>
<p>理论上PDNS Auth只会查询自己已有的DNS记录，如果不存在则会直接返回空，而不是继续向上递归查询。这里我们使用轻量型的DNS服务器dnsmasq作为对比，两者都没有手动添加任何的DNS解析记录。</p>
<p><img src="https://resource.tinychen.com/20210126165523.png" srcset="/img/loading.gif" lazyload></p>
<p>从上面的测试结果我们可以看出pdns auth只会返回自己的数据库中存在的记录。于是我们手动添加记录到pdns中再进行查询。</p>
<p>这里我们使用<code>pdnsutil</code>工具来简单测试，首先我们简单的创建一个关于example.org的zone，然后我们再创建关于example.org的一条A记录和MX记录，接着使用dig命令来进行测试：</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ pdnsutil create-zone example.org ns1.example.com
Feb <span class="token number">24</span> <span class="token number">16</span>:54:48 gmysql Connection successful. Connected to database <span class="token string">'powerdns'</span> on <span class="token string">'localhost'</span><span class="token builtin class-name">.</span>
Feb <span class="token number">24</span> <span class="token number">16</span>:54:48 gmysql Connection successful. Connected to database <span class="token string">'powerdns'</span> on <span class="token string">'localhost'</span><span class="token builtin class-name">.</span>
Creating empty zone <span class="token string">'example.org'</span>
Feb <span class="token number">24</span> <span class="token number">16</span>:54:48 No serial <span class="token keyword">for</span> <span class="token string">'example.org'</span> found - zone is missing?
Also adding one NS record

$ pdnsutil list-all-zones
Feb <span class="token number">24</span> <span class="token number">16</span>:54:59 gmysql Connection successful. Connected to database <span class="token string">'powerdns'</span> on <span class="token string">'localhost'</span><span class="token builtin class-name">.</span>
Feb <span class="token number">24</span> <span class="token number">16</span>:54:59 gmysql Connection successful. Connected to database <span class="token string">'powerdns'</span> on <span class="token string">'localhost'</span><span class="token builtin class-name">.</span>
tinychen.com
example.org

$  pdnsutil add-record example.org <span class="token string">''</span> MX <span class="token string">'25 mail.example.org'</span>
Feb <span class="token number">24</span> <span class="token number">16</span>:55:36 gmysql Connection successful. Connected to database <span class="token string">'powerdns'</span> on <span class="token string">'localhost'</span><span class="token builtin class-name">.</span>
Feb <span class="token number">24</span> <span class="token number">16</span>:55:36 gmysql Connection successful. Connected to database <span class="token string">'powerdns'</span> on <span class="token string">'localhost'</span><span class="token builtin class-name">.</span>
New rrset:
example.org. <span class="token number">3600</span> IN MX <span class="token number">25</span> mail.example.org

$  pdnsutil add-record example.org. www A <span class="token number">192.168</span>.100.100
Feb <span class="token number">24</span> <span class="token number">16</span>:56:09 gmysql Connection successful. Connected to database <span class="token string">'powerdns'</span> on <span class="token string">'localhost'</span><span class="token builtin class-name">.</span>
Feb <span class="token number">24</span> <span class="token number">16</span>:56:09 gmysql Connection successful. Connected to database <span class="token string">'powerdns'</span> on <span class="token string">'localhost'</span><span class="token builtin class-name">.</span>
New rrset:
www.example.org. <span class="token number">3600</span> IN A <span class="token number">192.168</span>.100.100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><img src="https://resource.tinychen.com/20210224170528.png" srcset="/img/loading.gif" lazyload></p>
<p>同样的我们对tinychen.com进行相同的操作，可以看到这时已经能够解析出对应的IP了。</p>
<p><img src="https://resource.tinychen.com/20210224171337.png" srcset="/img/loading.gif" lazyload></p>
<p>从上图中我们可以看到对应的<code>tinychen.com</code>域名解析出来的记录是我们手动设定的IP值。</p>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/network/" class="category-chain-item">network</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/dns/">#dns</a>
      
        <a href="/tags/powerdns/">#powerdns</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/20210303-tomcat-start-guide/" title="tomcat入门指北">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">tomcat入门指北</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/20210105-prometheus-01-binary-install/" title="Prometheus系列01-单机版二进制部署">
                        <span class="hidden-mobile">Prometheus系列01-单机版二进制部署</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <i class="iconfont icon-copyright"></i> <a href="https://tinychen.com/" target="_blank" rel="nofollow noopener"><span>2017~2022 By TinyChen </span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Hexo-Fluid</span></a> 
    </div>
  
  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      粤ICP备18140640号
    </a>
  </span>
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <!-- Baidu Analytics -->
    <script defer>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?7a96963a1145ac7fde1442d739a11ffd";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google Analytics -->
    <script defer>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript('https://www.google-analytics.com/analytics.js', function() {
          window.ga = window.ga || function() { (ga.q = ga.q || []).push(arguments) };
          ga.l = +new Date;
          ga('create', 'UA-166769908-1', 'auto');
          ga('send', 'pageview');
        });
      }
    </script>
  

  

  

  

  

  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
