

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://resource.tinychen.com/logos.png">
  <link rel="icon" href="https://resource.tinychen.com/logos.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="TinyChen">
  <meta name="keywords" content="">
  
    <meta name="description" content="小七比较喜欢在宿舍和室友一起看电影或听音乐，且对画质和音质要求较高，一般都是观看1080P的蓝光REMUX电影（约30G一部）和听无损音质的音乐（30M一首），且观看设备较多（电视盒子、电脑、手机），再加上平时需要下载电影且自己有写博客的习惯，博客和一些其他的重要资料也需要备份，因此决定使用树莓派3B+、一块移动硬盘和一个路由器搭建一个宿舍多媒体中心来满足这些需求。">
<meta property="og:type" content="article">
<meta property="og:title" content="树莓派3B+打造多媒体中心">
<meta property="og:url" content="https://tinychen.com/20180910-raspi-multi-media-centre/index.html">
<meta property="og:site_name" content="TinyChen&#39;s Studio">
<meta property="og:description" content="小七比较喜欢在宿舍和室友一起看电影或听音乐，且对画质和音质要求较高，一般都是观看1080P的蓝光REMUX电影（约30G一部）和听无损音质的音乐（30M一首），且观看设备较多（电视盒子、电脑、手机），再加上平时需要下载电影且自己有写博客的习惯，博客和一些其他的重要资料也需要备份，因此决定使用树莓派3B+、一块移动硬盘和一个路由器搭建一个宿舍多媒体中心来满足这些需求。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://resource.tinychen.com/20210617164850.jpg">
<meta property="article:published_time" content="2018-09-10T07:00:00.000Z">
<meta property="article:modified_time" content="2018-09-10T07:00:00.000Z">
<meta property="article:author" content="TinyChen">
<meta property="article:tag" content="hardware">
<meta property="article:tag" content="stu">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://resource.tinychen.com/20210617164850.jpg">
  
  
  <title>树莓派3B+打造多媒体中心 - TinyChen&#39;s Studio</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tinychen.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":30,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"bash"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"7a96963a1145ac7fde1442d739a11ffd","google":"UA-166769908-1","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="TinyChen's Studio" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>TinyChen</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://resource.tinychen.com/20210617164850.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="树莓派3B+打造多媒体中心"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2018-09-10 15:00" pubdate>
          September 10, 2018 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          16k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          133 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">树莓派3B+打造多媒体中心</h1>
            
              <p class="note note-info">
                
                  
                    Last updated on September 10, 2018 pm
                  
                
              </p>
            
            <div class="markdown-body">
              
              <p>小七比较喜欢在宿舍和室友一起看电影或听音乐，且对画质和音质要求较高，一般都是观看1080P的蓝光REMUX电影（约30G一部）和听无损音质的音乐（30M一首），且观看设备较多（电视盒子、电脑、手机），再加上平时需要下载电影且自己有写博客的习惯，博客和一些其他的重要资料也需要备份，因此决定使用树莓派3B+、一块移动硬盘和一个路由器搭建一个宿舍多媒体中心来满足这些需求。</p>
<span id="more"></span>

<hr>
<h1 id="1、功能简介"><a href="#1、功能简介" class="headerlink" title="1、功能简介"></a>1、功能简介</h1><h2 id="1-1-Samba"><a href="#1-1-Samba" class="headerlink" title="1.1 Samba"></a>1.1 Samba</h2><p><strong>Samba是在Linux和UNIX系统上实现SMB协议的一个免费软件，由服务器及客户端程序构成。SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。</strong></p>
<p>换言之，使用Samba可以在局域网内实现文件的共享操作，有些放在移动硬盘里面的文件需要用的时候就不用再插移动硬盘，在网上邻居处拷贝即可。</p>
<h2 id="1-2-miniDLNA"><a href="#1-2-miniDLNA" class="headerlink" title="1.2 miniDLNA"></a>1.2 miniDLNA</h2><p><strong>DLNA的全称是DIGITAL LIVING NETWORK ALLIANCE(数字生活网络联盟)，DLNA并不是创造技术，而是形成一种解决的方案，一种大家可以遵守的规范。</strong></p>
<p>所以，其选择的各种技术和协议都是当前所应用很广泛的技术和协议。miniDLNA可以实现音乐视频图片的局域网跨设备共享，且目前大多数智能手机、平板和电视均支持DLNA协议，在树莓派上安装miniDLNA服务后即可让处在同一局域网下的设备能轻松访问到树莓派上的影音资源。</p>
<h2 id="1-3-下载机"><a href="#1-3-下载机" class="headerlink" title="1.3 下载机"></a>1.3 下载机</h2><p><strong>Transmission全称TransmissionBittorrent，由C开发而成（Mac OS上用的是Objective-C），硬件资源消耗极少，界面极度精简。</strong>支持包括Linux、BSD、Solaris、Mac OS X等多种操作系统，以及Networked Media Tank、WD MyBook、ReadyNAS、D-Link DNS-323 &amp; CH3SNAS、Synology等多种设备。支持GTK+、命令行、Web等多种界面。</p>
<p><strong>Aria2支持Http、FTP、磁力链接和BT下载，可以和Transimission互补。</strong></p>
<h2 id="1-4-自动备份"><a href="#1-4-自动备份" class="headerlink" title="1.4 自动备份"></a>1.4 自动备份</h2><p>数据备份是一个好习惯，但是总是会有遗忘或者是疏漏的情况出现，因此我们可以利用树莓派来实现自动备份。<strong>首先可以创建powershell命令实现备份功能，再另存为bat脚本文件，最后利用windows自带的定时任务功能和linux的定时执行命令操作来实现文件自动备份到树莓派上的操作。</strong></p>
<h2 id="1-5-状态监控"><a href="#1-5-状态监控" class="headerlink" title="1.5 状态监控"></a>1.5 状态监控</h2><p>作为长时间运行的多媒体中心，树莓派的运行状态不能忽视，因此我们可以<strong>使用LCD1602显示屏</strong>连接树莓派，显示一些必要的信息来监控它的运行状态。<strong>（CPU，GPU, RAM, IP, TIME）</strong></p>
<h1 id="2、安装操作"><a href="#2、安装操作" class="headerlink" title="2、安装操作"></a>2、安装操作</h1><h2 id="2-1-Samba"><a href="#2-1-Samba" class="headerlink" title="2.1 Samba"></a>2.1 Samba</h2><h3 id="2-1-1-安装ntfs-3g"><a href="#2-1-1-安装ntfs-3g" class="headerlink" title="2.1.1 安装ntfs-3g"></a>2.1.1 安装ntfs-3g</h3><p>树莓派接上移动硬盘后，会自动挂载到/media目录下，但是由于我的硬盘是ntfs格式，在树莓系统下只能读不能写，因此我需要安装ntfs-3g服务实现对移动硬盘的写操作，然后再设置开机自动挂载移动硬盘。</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ntfs-3g
<span class="token comment">#安装ntfs -3g服务</span>

<span class="token function">sudo</span> <span class="token function">mkdir</span> /home/pi/share
<span class="token comment">#创建用于挂载移动硬盘的目录</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image001.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">umount</span> /dev/sda1
<span class="token comment">#有些系统会自动挂载，因此先使用umont命令取消挂载移动硬盘</span>
<span class="token comment">#后面的/dev/sda1是硬盘在此系统中对应的编号，可以使用 df -h命令查看，或者直接使用硬盘名代替</span>

<span class="token function">sudo</span> <span class="token function">mount</span> -t ntfs-3g /dev/sda1 /home/pi/share
<span class="token comment">#使用ntfs -3g挂载硬盘到指定目录</span>

<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi/share
<span class="token comment">#使用chmod命令赋予目录读写权限</span>

<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi
<span class="token comment">#目录的上级目录也需要赋予读写权限</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image002.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/fstab
<span class="token comment">#编辑/etc/fstab文件实现开机自动挂载硬盘</span>

<span class="token comment">#在文件的最后一行加入下列代码</span>
/dev/sda1   /home/pi/share  ntfsdefaults0   <span class="token number">0</span>
<span class="token comment">#第一列是挂载的硬盘设备名或者uuid</span>
<span class="token comment">#第二列是挂载的目录</span>
<span class="token comment">#第三列是硬盘的文件系统类型</span>
<span class="token comment">#第四列是文件系统的参数，defaults表示同时具有rw, suid, dev, exec, auto, nouser, async等默认参数的设置</span>
<span class="token comment">#第五列是能否被dump备份命令作用：dump是一个用来作为备份的命令。通常这个参数的值为0或者1，0表示不备份</span>
<span class="token comment">#第六列是是否检验扇区：开机的过程中，系统默认会以fsck检验我们系统是否为完整（clean）。0表示不要检验</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>



<p><img src="https://resource.tinychen.com/image003.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-1-2安装Samba"><a href="#2-1-2安装Samba" class="headerlink" title="2.1.2安装Samba"></a>2.1.2安装Samba</h3><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token comment">#首先更新一下系统源</span>

<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> samba samba-common-bin
<span class="token comment">#安装samba-common版本</span>
<span class="token comment">#samba-common：这个套件则主要提供了 SAMBA 的主要设定档(smb.conf) 、 smb.conf 语法检验的测试程序 ( testparm )等等；</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image004.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/samba/smb.conf
<span class="token comment">#编辑配置文件，在文件中加入下列内容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image005.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">security <span class="token operator">=</span> share
<span class="token comment">#开放security权限等级为share</span>
<span class="token comment">#share---不需要提供用户名和密码。</span>
<span class="token comment">#user----需要提供用户名和密码，而且身份验证由 samba server 负责。</span>
<span class="token comment">#server--需要提供用户名和密码，可指定其他机器(winNT/2000/XP)或另一台 samba server作身份验证。</span>
<span class="token comment">#domain--需要提供用户名和密码，指定winNT/2000/XP域服务器作身份验证。</span>

<span class="token punctuation">[</span>share<span class="token punctuation">]</span> 
<span class="token comment">#share为开启共享后的文件夹名</span>
comment <span class="token operator">=</span> samba share   
<span class="token comment">#comment为备注，帮助理解这个共享文件夹</span>
path <span class="token operator">=</span> /home/pi/share   
<span class="token comment">#path为共享的文件目录路径</span>
valid user <span class="token operator">=</span> pi root   
<span class="token comment">#vaild users-----设定只有此名单内的用户才能访问共享资源(拒绝优先)(用户名/@组名)，这里设置为pi和root两个</span>
public <span class="token operator">=</span> <span class="token function">yes</span>
<span class="token comment">#public----------是yes/否no公开共享，若为否则进行身份验证(只有当security = share 时此项才起作用)</span>
browseable <span class="token operator">=</span> <span class="token function">yes</span>
<span class="token comment">#browseable------是yes/否no在浏览资源中显示共享目录，若为否则必须指定共享路径才能存取</span>
writable <span class="token operator">=</span> <span class="token function">yes</span>  
<span class="token comment">#writable--------是yes/否no不以只读方式共享当与read only发生冲突时，无视read only</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image006.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> smbpasswd -a pi
<span class="token comment">#新建一个名为pi的用户，然后会提示输入两次密码</span>
<span class="token comment">#smbpasswd命令的一些用法如下</span>
<span class="token comment">#-a：向smbpasswd文件中添加用户；</span>
<span class="token comment">#-c：指定samba的配置文件；</span>
<span class="token comment">#-x：从smbpasswd文件中删除用户；</span>
<span class="token comment">#-d：在smbpasswd文件中禁用指定的用户；</span>
<span class="token comment">#-e：在smbpasswd文件中激活指定的用户；</span>
<span class="token comment">#-n：将指定的用户的密码置空。</span>

<span class="token comment">#设置完用户名和密码后输入下列命令激活用户</span>
<span class="token function">sudo</span> smbpasswd -e pi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image007.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#然后重启samba服务即可生效</span>
<span class="token function">sudo</span> /etc/init.d/samba restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image008.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#最后还是要设置开机启动</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/rc.local

<span class="token comment">#在下面添加如下代码</span>
<span class="token function">sudo</span> /etc/init.d/samba restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image009.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-1-3添加网络映射"><a href="#2-1-3添加网络映射" class="headerlink" title="2.1.3添加网络映射"></a>2.1.3添加网络映射</h3><p>添加网络映射主要是方便访问，可以将共享的samba文件夹添加到我的电脑中。首先右键我的电脑，点击添加网络映射/Add a network location<br><img src="https://resource.tinychen.com/image010.png" srcset="/img/loading.gif" lazyload></p>
<p>输入共享的文件夹路径，然后命名，最后即可完成。<br><img src="https://resource.tinychen.com/image011.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://resource.tinychen.com/image012.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://resource.tinychen.com/image013.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2-2-miniDLNA"><a href="#2-2-miniDLNA" class="headerlink" title="2.2 miniDLNA"></a>2.2 miniDLNA</h2><h3 id="2-2-1-安装miniDLNA"><a href="#2-2-1-安装miniDLNA" class="headerlink" title="2.2.1 安装miniDLNA"></a>2.2.1 安装miniDLNA</h3><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token comment">#先更新一下安装源</span>

<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> minidlna
<span class="token comment">#安装minidlna</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image014.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#安装完后编辑配置文件</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/minidlna.conf

<span class="token assign-left variable">media_dir</span><span class="token operator">=</span>A,/home/pi/share/Music
<span class="token comment">#A表示这个目录是存放音乐的，当minidlna读到配置文件时，它会自动加载这个目录下的音乐文件 </span>
<span class="token assign-left variable">media_dir</span><span class="token operator">=</span>P,/home/pi/share/Picture  
<span class="token comment">#P表示图片文件  </span>
<span class="token assign-left variable">media_dir</span><span class="token operator">=</span>V,/home/pi/share/Video
<span class="token comment">#V表示视频文件</span>
<span class="token assign-left variable">db_dir</span><span class="token operator">=</span>/home/pi/share/dlnadb
<span class="token comment">#配置minidlna的数库数据的存放目录 </span>
<span class="token assign-left variable">log_dir</span><span class="token operator">=</span>/home/pi/share/dlnalog  
<span class="token comment">#配置日志目录 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image015.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#然后建立对应的文件夹并给予对应的权限</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> /home/pi/share/Music
<span class="token function">sudo</span> <span class="token function">mkdir</span> /home/pi/share/Picture
<span class="token function">sudo</span> <span class="token function">mkdir</span> /home/pi/share/Video
<span class="token function">sudo</span> <span class="token function">mkdir</span> /home/pi/share/dlnadb
<span class="token function">sudo</span> <span class="token function">mkdir</span> /home/pi/share/dlnalog

<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi/share/Music
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi/share/Picture
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi/share/Video
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi/share/dlnadb
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi/share/dlnalog

<span class="token comment">#使用下列命令重启dlna服务</span>
<span class="token function">sudo</span> /etc/init.d/minidlna restart

<span class="token comment">#再使用下列命令查看dlna状态</span>
<span class="token function">sudo</span> /etc/init.d/minidlna status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image016.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#最后修改开机启动文件</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/rc.local
<span class="token comment">#在后面加入以下代码</span>
<span class="token function">sudo</span> /etc/init.d/minidlna restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image017.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-2-2-添加DLNA设备"><a href="#2-2-2-添加DLNA设备" class="headerlink" title="2.2.2 添加DLNA设备"></a>2.2.2 添加DLNA设备</h3><p>点击我的电脑左上方的流媒体</p>
<p><img src="https://resource.tinychen.com/image018.png" srcset="/img/loading.gif" lazyload></p>
<p>系统会自动搜索到局域网中的支持DLNA的设备，点击添加，等待添加完成。</p>
<p><img src="https://resource.tinychen.com/image019.png" srcset="/img/loading.gif" lazyload></p>
<p>打开支持DLNA或者是流媒体播放的软件，就能看到树莓派中的流媒体文件。</p>
<p><img src="https://resource.tinychen.com/image020.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2-3-下载机"><a href="#2-3-下载机" class="headerlink" title="2.3 下载机"></a>2.3 下载机</h2><h3 id="2-3-1-安装transmission"><a href="#2-3-1-安装transmission" class="headerlink" title="2.3.1 安装transmission"></a>2.3.1 安装transmission</h3><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token comment">#先更新一下安装源</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> transmission-daemon
<span class="token comment">#然后安装transmission</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><img src="https://resource.tinychen.com/image021.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#创建目录用于存放下载文件</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> /home/pi/share/Downloads/Incomplete  
<span class="token comment">#存放未下载完成的文件</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> /home/pi/share/Downloads/complete
<span class="token comment">#存放下载完成的文件</span>

<span class="token comment">#更改文件所属组别</span>
<span class="token function">sudo</span> <span class="token function">chgrp</span> debian-transmission /home/pi/share/Downloads/Incomplete
<span class="token function">sudo</span> <span class="token function">chgrp</span> debian-transmission /home/pi/share/Downloads/complete

<span class="token comment">#赋予文件夹权限</span>
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi/share/Downloads/Incomplete 
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /home/pi/share/Downloads/complete <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image022.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#修改配置文件</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/transmission-daemon/settings.json

<span class="token comment">#找到以下项进行修改</span>
<span class="token comment">#已完成的下载目录</span>
<span class="token string">"download-dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/home/pi/share/Downloads/complete"</span>,
<span class="token comment">#未完成的下载目录</span>
<span class="token string">"incomplete-dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/home/pi/share/Downloads/Incomplete"</span>,
<span class="token comment">#允许Web访问的白名单地址,这里要根据自己的路由器实际IP地址进行修改</span>
<span class="token string">"rpc-whitelist"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.8.*"</span>,
<span class="token comment">#登录的用户名</span>
“rpc-username”: “yourname”,
<span class="token comment">#登录的密码</span>
“rpc-password”: “yoursecretcode”,

<span class="token comment">#最后依次执行下面的两条命令完成重启服务</span>
<span class="token function">sudo</span> <span class="token function">service</span> transmission-daemon reload
<span class="token function">sudo</span> <span class="token function">service</span> transmission-daemon restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p>最后我们访问树莓派的IP再加上9091端口就能登录到下载界面。<br><img src="https://resource.tinychen.com/image023.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://resource.tinychen.com/image024.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://resource.tinychen.com/image025.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-3-2-安装Aria2"><a href="#2-3-2-安装Aria2" class="headerlink" title="2.3.2 安装Aria2"></a>2.3.2 安装Aria2</h3><h4 id="2-3-2-1-安装Aria2"><a href="#2-3-2-1-安装Aria2" class="headerlink" title="2.3.2.1 安装Aria2"></a>2.3.2.1 安装Aria2</h4><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token comment">#更新一下安装源</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> aria2
<span class="token comment">#安装aria2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image026.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#在/etc目录下创建aria2目录用来存放配置文件：</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/aria2

<span class="token comment">#创建空白的aria2.session文件：</span>
<span class="token function">sudo</span> <span class="token function">touch</span> /etc/aria2/aria2.session

<span class="token comment">#创建配置文件</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/aria2/aria2.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image027.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#在该文件中输入以下内容：</span>

<span class="token assign-left variable">dir</span><span class="token operator">=</span>/home/pi/share/Downloads
<span class="token comment">#设置文件下载的存放目录 </span>
disable-ipv6<span class="token operator">=</span>true 
<span class="token comment">#打开rpc的目的是为了给web管理端用 </span>
enable-rpc<span class="token operator">=</span>true 
rpc-allow-origin-all<span class="token operator">=</span>true 
rpc-listen-all<span class="token operator">=</span>true 
<span class="token comment">#rpc-listen-port=6800 </span>
<span class="token assign-left variable">continue</span><span class="token operator">=</span>true 
input-file<span class="token operator">=</span>/etc/aria2/aria2.session 
save-session<span class="token operator">=</span>/etc/aria2/aria2.session 
max-concurrent-downloads<span class="token operator">=</span><span class="token number">3</span>
<span class="token comment">#设置最大同时下载的任务数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image028.png" srcset="/img/loading.gif" lazyload></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#启动aria2</span>
<span class="token function">sudo</span> aria2c --conf-path<span class="token operator">=</span>/etc/aria2/aria2.conf

<span class="token comment">#如果没有提示任何错误信息，那就按ctrl+c停止上面的语句，转为后台运行：</span>

<span class="token function">sudo</span> aria2c --conf-path<span class="token operator">=</span>/etc/aria2/aria2.conf －D

<span class="token comment">#同时其此句写到开机启动中，编辑/etc/rc.local</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/rc.local

<span class="token comment">#在文件的最后面添加这一行</span>
<span class="token function">sudo</span> aria2c --conf-path<span class="token operator">=</span>/etc/aria2/aria2.conf －D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image029.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="2-3-2-2-安装appache"><a href="#2-3-2-2-安装appache" class="headerlink" title="2.3.2.2 安装appache"></a>2.3.2.2 安装appache</h4><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#安装appach</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> apache2

<span class="token comment">#修改/var/www/html的权限</span>
<span class="token function">chmod</span> <span class="token number">777</span> /var/www/html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image030.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://resource.tinychen.com/image031.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="2-3-2-3-安装yaaw"><a href="#2-3-2-3-安装yaaw" class="headerlink" title="2.3.2.3 安装yaaw"></a>2.3.2.3 安装yaaw</h4><p>从<a target="_blank" rel="noopener" href="https://github.com/binux/yaaw%E4%B8%8B%E8%BD%BDyaaw%EF%BC%8C%E7%82%B9%E5%87%BB%E5%8F%B3%E4%B8%8B%E8%A7%92%E7%9A%84Download">https://github.com/binux/yaaw下载yaaw，点击右下角的Download</a> Zip, 下载后将解压后的文件夹内容拷贝到/var/www/html文件夹下。这时在浏览器内输入树莓派的IP，如果出现以下页面，则表示已经正常工作了。</p>
<p><strong>点击左上方的add就可以进行下载。</strong></p>
<p><img src="https://resource.tinychen.com/image032.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2-4-自动备份"><a href="#2-4-自动备份" class="headerlink" title="2.4 自动备份"></a>2.4 自动备份</h2><h3 id="2-4-1-创建自动执行文件"><a href="#2-4-1-创建自动执行文件" class="headerlink" title="2.4.1 创建自动执行文件"></a>2.4.1 创建自动执行文件</h3><p>使用记事本新建一个文件，里面输入下列代码，然后保存并更改文件名后缀为bat执行文件。</p>
<div class="code-wrapper"><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo off
echo Backuping D:\MyBlog\source\_posts---------&gt;192.168.8.106\share\Backup
xcopy &quot;D:\MyBlog\source\_posts&quot; &quot;\\RASPBERRYPI\share\Backup&quot; &#x2F;e&#x2F;I&#x2F;d&#x2F;h&#x2F;r&#x2F;y
exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>

<p>其中xcopy指令后两个路径分别为需要备份的文件夹路径和用于存放备份的文件夹路径，其余参数说明如下：</p>
<p><strong>/e：拷贝所有子目录，包括空子目录；</strong></p>
<p><strong>/I： 如果目标文件或目录不存在且拷贝的文件数多于一，则假设目标为目录；</strong></p>
<p><strong>/d：只拷贝文件日期与在目标文件后的文件（即修改过的源文件）</strong></p>
<p><strong>/h：同时拷贝隐藏文件和系统文件</strong></p>
<p><strong>/r：拷贝并覆盖只读文件</strong></p>
<p><strong>/y： 复制文件审核设置（不显示已有文件覆盖确认）</strong></p>
<p>以上参数可以根据需要添加，推荐都加上最好。</p>
<h3 id="2-4-2-设置定时任务"><a href="#2-4-2-设置定时任务" class="headerlink" title="2.4.2 设置定时任务"></a>2.4.2 设置定时任务</h3><p><strong>然后我们打开”控制面板”—“计划任务”添加计划任务，计划任务里的执行目标为该批处理文件，设定在什么时候执行则由个人决定。</strong></p>
<p>执行效果示例如下：</p>
<p><img src="https://resource.tinychen.com/image033.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2-5-状态监控"><a href="#2-5-状态监控" class="headerlink" title="2.5 状态监控"></a>2.5 状态监控</h2><p>按照针脚跳线连接好LCD1602和树莓派并调节好LCD1602的对比度，使用python编写代码，控制1602输出相关信息，具体代码如下：</p>
<p><strong>将下面这个文件保存为lcd1602.py</strong></p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span>
 
<span class="token comment">#</span>
<span class="token comment"># based on code from lrvick and LiquidCrystal</span>
<span class="token comment"># lrvic - https://github.com/lrvick/raspi-hd44780/blob/master/hd44780.py</span>
<span class="token comment"># LiquidCrystal - https://github.com/arduino/Arduino/blob/master/libraries/LiquidCrystal/LiquidCrystal.cpp</span>
<span class="token comment">#</span>
 
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
 
<span class="token keyword">class</span> <span class="token class-name">lcd1602</span><span class="token punctuation">:</span>
 
<span class="token comment"># commands</span>
LCD_CLEARDISPLAY<span class="token operator">=</span> <span class="token number">0x01</span>
LCD_RETURNHOME  <span class="token operator">=</span> <span class="token number">0x02</span>
LCD_ENTRYMODESET<span class="token operator">=</span> <span class="token number">0x04</span>
LCD_DISPLAYCONTROL  <span class="token operator">=</span> <span class="token number">0x08</span>
LCD_CURSORSHIFT <span class="token operator">=</span> <span class="token number">0x10</span>
LCD_FUNCTIONSET <span class="token operator">=</span> <span class="token number">0x20</span>
LCD_SETCGRAMADDR<span class="token operator">=</span> <span class="token number">0x40</span>
LCD_SETDDRAMADDR<span class="token operator">=</span> <span class="token number">0x80</span>
 
<span class="token comment"># flags for display entry mode</span>
LCD_ENTRYRIGHT  <span class="token operator">=</span> <span class="token number">0x00</span>
LCD_ENTRYLEFT   <span class="token operator">=</span> <span class="token number">0x02</span>
LCD_ENTRYSHIFTINCREMENT <span class="token operator">=</span> <span class="token number">0x01</span>
LCD_ENTRYSHIFTDECREMENT <span class="token operator">=</span> <span class="token number">0x00</span>
 
<span class="token comment"># flags for display on/off control</span>
LCD_DISPLAYON   <span class="token operator">=</span> <span class="token number">0x04</span>
LCD_DISPLAYOFF  <span class="token operator">=</span> <span class="token number">0x00</span>
LCD_CURSORON<span class="token operator">=</span> <span class="token number">0x02</span>
LCD_CURSOROFF   <span class="token operator">=</span> <span class="token number">0x00</span>
LCD_BLINKON <span class="token operator">=</span> <span class="token number">0x01</span>
LCD_BLINKOFF<span class="token operator">=</span> <span class="token number">0x00</span>
 
<span class="token comment"># flags for display/cursor shift</span>
LCD_DISPLAYMOVE <span class="token operator">=</span> <span class="token number">0x08</span>
LCD_CURSORMOVE  <span class="token operator">=</span> <span class="token number">0x00</span>
 
<span class="token comment"># flags for display/cursor shift</span>
LCD_DISPLAYMOVE <span class="token operator">=</span> <span class="token number">0x08</span>
LCD_CURSORMOVE  <span class="token operator">=</span> <span class="token number">0x00</span>
LCD_MOVERIGHT   <span class="token operator">=</span> <span class="token number">0x04</span>
LCD_MOVELEFT<span class="token operator">=</span> <span class="token number">0x00</span>
 
<span class="token comment"># flags for function set</span>
LCD_8BITMODE<span class="token operator">=</span> <span class="token number">0x10</span>
LCD_4BITMODE<span class="token operator">=</span> <span class="token number">0x00</span>
LCD_2LINE   <span class="token operator">=</span> <span class="token number">0x08</span>
LCD_1LINE   <span class="token operator">=</span> <span class="token number">0x00</span>
LCD_5x10DOTS<span class="token operator">=</span> <span class="token number">0x04</span>
LCD_5x8DOTS <span class="token operator">=</span> <span class="token number">0x00</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​<br>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pin_rs<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> pin_e<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> pins_db<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GPIO <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># Emulate the old behavior of using RPi.GPIO if we haven't been given</span>
<span class="token comment"># an explicit GPIO interface to use</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> GPIO<span class="token punctuation">:</span>
<span class="token keyword">import</span> RPi<span class="token punctuation">.</span>GPIO <span class="token keyword">as</span> GPIO
self<span class="token punctuation">.</span>GPIO <span class="token operator">=</span> GPIO
self<span class="token punctuation">.</span>pin_rs <span class="token operator">=</span> pin_rs
self<span class="token punctuation">.</span>pin_e <span class="token operator">=</span> pin_e
self<span class="token punctuation">.</span>pins_db <span class="token operator">=</span> pins_db
 
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>setmode<span class="token punctuation">(</span>GPIO<span class="token punctuation">.</span>BCM<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>setwarnings<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>setup<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pin_e<span class="token punctuation">,</span> GPIO<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>setup<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pin_rs<span class="token punctuation">,</span> GPIO<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>
 
<span class="token keyword">for</span> pin <span class="token keyword">in</span> self<span class="token punctuation">.</span>pins_db<span class="token punctuation">:</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>setup<span class="token punctuation">(</span>pin<span class="token punctuation">,</span> GPIO<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>
 
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span><span class="token number">0x33</span><span class="token punctuation">)</span> <span class="token comment"># initialization</span>
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span><span class="token number">0x32</span><span class="token punctuation">)</span> <span class="token comment"># initialization</span>
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">)</span> <span class="token comment"># 2 line 5x7 matrix</span>
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span><span class="token number">0x0C</span><span class="token punctuation">)</span> <span class="token comment"># turn cursor off 0x0E to enable cursor</span>
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span><span class="token number">0x06</span><span class="token punctuation">)</span> <span class="token comment"># shift cursor right</span>
 
self<span class="token punctuation">.</span>displaycontrol <span class="token operator">=</span> self<span class="token punctuation">.</span>LCD_DISPLAYON <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_CURSOROFF <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_BLINKOFF
 
self<span class="token punctuation">.</span>displayfunction <span class="token operator">=</span> self<span class="token punctuation">.</span>LCD_4BITMODE <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_1LINE <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_5x8DOTS
self<span class="token punctuation">.</span>displayfunction <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>LCD_2LINE
 
<span class="token triple-quoted-string string">""" Initialize to default text direction (for romance languages) """</span>
self<span class="token punctuation">.</span>displaymode <span class="token operator">=</span>  self<span class="token punctuation">.</span>LCD_ENTRYLEFT <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_ENTRYSHIFTDECREMENT
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_ENTRYMODESET <span class="token operator">|</span> self<span class="token punctuation">.</span>displaymode<span class="token punctuation">)</span> <span class="token comment">#  set the entry mode</span>
 
self<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">begin</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cols<span class="token punctuation">,</span> lines<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
<span class="token keyword">if</span> <span class="token punctuation">(</span>lines <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
self<span class="token punctuation">.</span>numlines <span class="token operator">=</span> lines
self<span class="token punctuation">.</span>displayfunction <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>LCD_2LINE
self<span class="token punctuation">.</span>currline <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_RETURNHOME<span class="token punctuation">)</span> <span class="token comment"># set cursor position to zero</span>
self<span class="token punctuation">.</span>delayMicroseconds<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span> <span class="token comment"># this command takes a long time!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">clear</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_CLEARDISPLAY<span class="token punctuation">)</span> <span class="token comment"># command to clear display</span>
self<span class="token punctuation">.</span>delayMicroseconds<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token comment"># 3000 microsecond sleep, clearing the display takes a long time</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">setCursor</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> col<span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
self<span class="token punctuation">.</span>row_offsets <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0x54</span> <span class="token punctuation">]</span>
 
<span class="token keyword">if</span> <span class="token punctuation">(</span> row <span class="token operator">></span> self<span class="token punctuation">.</span>numlines <span class="token punctuation">)</span><span class="token punctuation">:</span> 
row <span class="token operator">=</span> self<span class="token punctuation">.</span>numlines <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment"># we count rows starting w/0</span>
 
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_SETDDRAMADDR <span class="token operator">|</span> <span class="token punctuation">(</span>col <span class="token operator">+</span> self<span class="token punctuation">.</span>row_offsets<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">noDisplay</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> 
<span class="token triple-quoted-string string">""" Turn the display off (quickly) """</span>
 
self<span class="token punctuation">.</span>displaycontrol <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span>self<span class="token punctuation">.</span>LCD_DISPLAYON
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_DISPLAYCONTROL <span class="token operator">|</span> self<span class="token punctuation">.</span>displaycontrol<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" Turn the display on (quickly) """</span>
 
self<span class="token punctuation">.</span>displaycontrol <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>LCD_DISPLAYON
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_DISPLAYCONTROL <span class="token operator">|</span> self<span class="token punctuation">.</span>displaycontrol<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">noCursor</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" Turns the underline cursor on/off """</span>
 
self<span class="token punctuation">.</span>displaycontrol <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span>self<span class="token punctuation">.</span>LCD_CURSORON
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_DISPLAYCONTROL <span class="token operator">|</span> self<span class="token punctuation">.</span>displaycontrol<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">cursor</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" Cursor On """</span>
 
self<span class="token punctuation">.</span>displaycontrol <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>LCD_CURSORON
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_DISPLAYCONTROL <span class="token operator">|</span> self<span class="token punctuation">.</span>displaycontrol<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">noBlink</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" Turn on and off the blinking cursor """</span>
 
self<span class="token punctuation">.</span>displaycontrol <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span>self<span class="token punctuation">.</span>LCD_BLINKON
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_DISPLAYCONTROL <span class="token operator">|</span> self<span class="token punctuation">.</span>displaycontrol<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">noBlink</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" Turn on and off the blinking cursor """</span>
 
self<span class="token punctuation">.</span>displaycontrol <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span>self<span class="token punctuation">.</span>LCD_BLINKON
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_DISPLAYCONTROL <span class="token operator">|</span> self<span class="token punctuation">.</span>displaycontrol<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">DisplayLeft</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" These commands scroll the display without changing the RAM """</span>
 
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_CURSORSHIFT <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_DISPLAYMOVE <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_MOVELEFT<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">scrollDisplayRight</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" These commands scroll the display without changing the RAM """</span>
 
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_CURSORSHIFT <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_DISPLAYMOVE <span class="token operator">|</span> self<span class="token punctuation">.</span>LCD_MOVERIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">leftToRight</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" This is for text that flows Left to Right """</span>
 
self<span class="token punctuation">.</span>displaymode <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>LCD_ENTRYLEFT
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_ENTRYMODESET <span class="token operator">|</span> self<span class="token punctuation">.</span>displaymode<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">rightToLeft</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" This is for text that flows Right to Left """</span>
self<span class="token punctuation">.</span>displaymode <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span>self<span class="token punctuation">.</span>LCD_ENTRYLEFT
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_ENTRYMODESET <span class="token operator">|</span> self<span class="token punctuation">.</span>displaymode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">autoscroll</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" This will 'right justify' text from the cursor """</span>
 
self<span class="token punctuation">.</span>displaymode <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>LCD_ENTRYSHIFTINCREMENT
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_ENTRYMODESET <span class="token operator">|</span> self<span class="token punctuation">.</span>displaymode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">noAutoscroll</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> 
<span class="token triple-quoted-string string">""" This will 'left justify' text from the cursor """</span>
 
self<span class="token punctuation">.</span>displaymode <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span>self<span class="token punctuation">.</span>LCD_ENTRYSHIFTINCREMENT
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LCD_ENTRYMODESET <span class="token operator">|</span> self<span class="token punctuation">.</span>displaymode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">write4bits</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bits<span class="token punctuation">,</span> char_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" Send command to LCD """</span>
 
self<span class="token punctuation">.</span>delayMicroseconds<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment"># 1000 microsecond sleep</span>
 
bits<span class="token operator">=</span><span class="token builtin">bin</span><span class="token punctuation">(</span>bits<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
 
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pin_rs<span class="token punctuation">,</span> char_mode<span class="token punctuation">)</span>
 
<span class="token keyword">for</span> pin <span class="token keyword">in</span> self<span class="token punctuation">.</span>pins_db<span class="token punctuation">:</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
 
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">if</span> bits<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">:</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pins_db<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
 
self<span class="token punctuation">.</span>pulseEnable<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
<span class="token keyword">for</span> pin <span class="token keyword">in</span> self<span class="token punctuation">.</span>pins_db<span class="token punctuation">:</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
 
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">if</span> bits<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">:</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pins_db<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
 
self<span class="token punctuation">.</span>pulseEnable<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> microseconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
seconds <span class="token operator">=</span> microseconds <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token comment"># divide microseconds by 1 million for seconds</span>
sleep<span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">pulseEnable</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pin_e<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>delayMicroseconds<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment"># 1 microsecond pause - enable pulse must be > 450ns </span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pin_e<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>delayMicroseconds<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment"># 1 microsecond pause - enable pulse must be > 450ns </span>
self<span class="token punctuation">.</span>GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pin_e<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>delayMicroseconds<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment"># commands need > 37us to settle</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">message</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">""" Send string to LCD、Newline wraps to second line"""</span>
 
<span class="token keyword">for</span> char <span class="token keyword">in</span> text<span class="token punctuation">:</span>
<span class="token keyword">if</span> char <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">:</span>
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span><span class="token number">0xC0</span><span class="token punctuation">)</span> <span class="token comment"># next line</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
self<span class="token punctuation">.</span>write4bits<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​     </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
 
lcd <span class="token operator">=</span> lcd1602<span class="token punctuation">(</span><span class="token punctuation">)</span>
lcd<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
lcd<span class="token punctuation">.</span>message<span class="token punctuation">(</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><strong>再将这个文件保存为1602.py</strong></p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span>
 
<span class="token keyword">from</span> lcd1602 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> commands
 
<span class="token keyword">def</span> <span class="token function">get_cpu_temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
tmp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/sys/class/thermal/thermal_zone0/temp'</span><span class="token punctuation">)</span>
cpu <span class="token operator">=</span> tmp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
tmp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token string">'&#123;:.2f&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span> <span class="token builtin">float</span><span class="token punctuation">(</span>cpu<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1000</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' C'</span>
 
<span class="token keyword">def</span> <span class="token function">get_gpu_temp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
tmp <span class="token operator">=</span> commands<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">'vcgencmd measure_temp|awk -F= \'&#123;print $2&#125;\''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\'C'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
gpu <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token string">'&#123;:.2f&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span> gpu <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' C'</span>
 
<span class="token keyword">def</span> <span class="token function">get_time_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%H:%M:%S\n   %Y-%m-%d'</span><span class="token punctuation">)</span>
 
<span class="token keyword">def</span> <span class="token function">get_ip_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
ip<span class="token operator">=</span> commands<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">'ifconfig eth0 | grep inet | awk \'&#123; print $2 &#125;\' | awk \'NR==1\''</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token string">'Ethernet IP:\n'</span> <span class="token operator">+</span> ip 
 
<span class="token keyword">def</span> <span class="token function">get_mem_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
total<span class="token operator">=</span> commands<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">'free -m|grep Mem:|awk \'&#123;print $2&#125;\''</span><span class="token punctuation">)</span>  
free<span class="token operator">=</span> commands<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">'free -m|grep Mem:|awk \'&#123;print $4&#125;\''</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token string">'MEM:\n'</span> <span class="token operator">+</span> free <span class="token operator">+</span><span class="token string">'/'</span><span class="token operator">+</span> total <span class="token operator">+</span><span class="token string">'M'</span>
 
lcd <span class="token operator">=</span> lcd1602<span class="token punctuation">(</span><span class="token punctuation">)</span>
lcd<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
 
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
lcd<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
lcd<span class="token punctuation">.</span>message<span class="token punctuation">(</span> get_ip_info<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
 
lcd<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
lcd<span class="token punctuation">.</span>message<span class="token punctuation">(</span> get_time_now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
 
lcd<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
lcd<span class="token punctuation">.</span>message<span class="token punctuation">(</span> get_mem_info<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
 
lcd<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
lcd<span class="token punctuation">.</span>message<span class="token punctuation">(</span> <span class="token string">'CPU: '</span> <span class="token operator">+</span> get_cpu_temp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\n'</span> <span class="token punctuation">)</span>
lcd<span class="token punctuation">.</span>message<span class="token punctuation">(</span> <span class="token string">'GPU: '</span> <span class="token operator">+</span> get_gpu_temp<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><strong>最后将两个文件保存到同一个目录下面，然后编辑文件设置开机启动即可让LCD1602循环显示信息。</strong></p>
<p><strong>我将这两个文件保存到/home/pi/1602目录下</strong></p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#编辑配置文件</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/rc.local
<span class="token comment">#将此命令添加到文件最后</span>
<span class="token function">sudo</span> python /home/pi/1602/1602.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><img src="https://resource.tinychen.com/image034.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="3、爬虫服务器"><a href="#3、爬虫服务器" class="headerlink" title="3、爬虫服务器"></a>3、爬虫服务器</h1><h2 id="3-1-Python源码示例"><a href="#3-1-Python源码示例" class="headerlink" title="3.1 Python源码示例"></a>3.1 Python源码示例</h2><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#encoding='UTF-8'</span>
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> request
<span class="token keyword">import</span> json
<span class="token keyword">import</span> time
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> timedelta
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm
<span class="token keyword">import</span> random
<span class="token keyword">import</span> re
<span class="token keyword">import</span> csv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 获取数据，根据url获取</span>
<span class="token keyword">def</span> <span class="token function">get_data</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
<span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36'</span>
<span class="token punctuation">&#125;</span>
req <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
response <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token keyword">if</span> response<span class="token punctuation">.</span>getcode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token boolean">None</span>

<span class="token comment"># 处理数据</span>
<span class="token keyword">def</span> <span class="token function">parse_data</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">:</span>
data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'cmts'</span><span class="token punctuation">]</span>  <span class="token comment"># 将str转换为json</span>
comments <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
comment <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
<span class="token string">'id'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token comment">#'nickName': item['nickName'],</span>
<span class="token string">'cityName'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'cityName'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token string">'cityName'</span> <span class="token keyword">in</span> item <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment"># 处理cityName不存在的情况</span>
<span class="token comment"># 处理评论内容换行的情况,并且将逗号替换为空格</span>
<span class="token string">'content'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'”'</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'“'</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'，'</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
<span class="token string">'score'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">'startTime'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'startTime'</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
comments<span class="token punctuation">.</span>append<span class="token punctuation">(</span>comment<span class="token punctuation">)</span>
<span class="token keyword">return</span> comments

<span class="token comment"># 存储数据，存储到文本文件</span>
<span class="token keyword">def</span> <span class="token function">savetoCSV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment">#设置指定时间向前爬取评论数据或者从特定的时间段爬取评论</span>
<span class="token comment">#start_time = '2015-05-12 02:40:34'</span>
start_time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>  <span class="token comment"># 获取当前时间，从当前时间向前获取</span>
<span class="token comment">#设置爬取评论数据的截至时间</span>
end_time <span class="token operator">=</span> <span class="token string">'2015-05-01 00:00:00'</span>
<span class="token keyword">while</span> start_time <span class="token operator">></span> end_time<span class="token punctuation">:</span>
url <span class="token operator">=</span> <span class="token string">'http://m.maoyan.com/mmdb/comments/movie/248170.json?_v_=yes&amp;offset=0&amp;startTime='</span> <span class="token operator">+</span> start_time<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'%20'</span><span class="token punctuation">)</span>
html <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token triple-quoted-string string">'''
问题：当请求过于频繁时，服务器会拒绝连接，实际上是服务器的反爬虫策略
解决：1.在每个请求间增加延时0.1秒，尽量减少请求被拒绝
 2.如果被拒绝，则0.5秒后重试
'''</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
html <span class="token operator">=</span> get_data<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
html <span class="token operator">=</span> get_data<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>

comments <span class="token operator">=</span> parse_data<span class="token punctuation">(</span>html<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>comments<span class="token punctuation">)</span>
start_time <span class="token operator">=</span> comments<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'startTime'</span><span class="token punctuation">]</span>  <span class="token comment"># 获得末尾评论的时间</span>
start_time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>start_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span> <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为datetime类型，减1秒，避免获取到重复数据</span>
start_time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>start_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为str</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​    </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> item <span class="token keyword">in</span> comments<span class="token punctuation">:</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test3.csv'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> item<span class="token punctuation">[</span><span class="token string">'startTime'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'[\''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> item<span class="token punctuation">[</span><span class="token string">'cityName'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
<span class="token comment">#f.write(str(item['id'])+','+item['nickName'] + ',' + item['cityName'] + ',' + item['content'] + ',' + str(item['score'])+ ',' + item['startTime'] + '\n')</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>


<p>​<br>​    </p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
html <span class="token operator">=</span> get_data<span class="token punctuation">(</span><span class="token string">'http://m.maoyan.com/mmdb/comments/movie/248170.json?_v_=yes&amp;offset=0&amp;startTime=2018-12-31%2022%3A25%3A03'</span><span class="token punctuation">)</span>
comments <span class="token operator">=</span> parse_data<span class="token punctuation">(</span>html<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>comments<span class="token punctuation">)</span>
savetoCSV<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h2 id="3-2-效果展示"><a href="#3-2-效果展示" class="headerlink" title="3.2 效果展示"></a>3.2 效果展示</h2><p><img src="https://resource.tinychen.com/raspi%E6%9C%AA%E5%91%BD%E5%90%8D1546430991.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="4、写在最后"><a href="#4、写在最后" class="headerlink" title="4、写在最后"></a>4、写在最后</h1><p><strong>重启之后就可以尽情地享用树莓派打造的多媒体中心了，虽然树莓派3B+只有USB2.0接口，但是只要搭配上百兆lan口的路由器，局域网内流畅观看40G左右大小的一部电影还是毫无问题的。</strong></p>
<p>如果有更高的需求，还是建议上更好的路由器和NAS吧。</p>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/linux/" class="category-chain-item">linux</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/hardware/">#hardware</a>
      
        <a href="/tags/stu/">#stu</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/20181109-ubuntu-change-time/" title="Ubuntu18.04与Win10时间不一致">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Ubuntu18.04与Win10时间不一致</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/20180824-androidstudio-install/" title="Android Studio配置">
                        <span class="hidden-mobile">Android Studio配置</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <i class="iconfont icon-copyright"></i> <a href="https://tinychen.com/" target="_blank" rel="nofollow noopener"><span>2017~2022 By TinyChen </span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Hexo-Fluid</span></a> 
    </div>
  
  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      粤ICP备18140640号
    </a>
  </span>
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <!-- Baidu Analytics -->
    <script defer>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?7a96963a1145ac7fde1442d739a11ffd";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google Analytics -->
    <script defer>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript('https://www.google-analytics.com/analytics.js', function() {
          window.ga = window.ga || function() { (ga.q = ga.q || []).push(arguments) };
          ga.l = +new Date;
          ga('create', 'UA-166769908-1', 'auto');
          ga('send', 'pageview');
        });
      }
    </script>
  

  

  

  

  

  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
